# 🎴 Limitless TCG Scraper

**ポケモンTCGポケット環境適応型メタ分析システム**

40デッキ+全相性データを自動収集し、環境適応型メタスコア算出法により真の最強デッキを発見するアプリケーション。従来のメタゲーム理論を覆す革命的発見を実現。

## ✨ 特徴

### 🔬 革新的な分析手法
- **環境適応型期待勝率**: 実際の環境分布を考慮した期待勝率を算出
- **従来の問題を解決**: 単純な勝率やシェア率では見つからない真の強デッキを発見
- **実例**: 使用率1.67%でも期待勝率57.14%の隠れた最強デッキを検出可能

### 📊 多角的な分析機能
- Tierリスト生成（SS～C評価）
- トーナメント構成の推奨（メイン・サブ・メタ読み）
- スキルレベル別デッキ推奨
- メタサイクル検出
- 環境の多様性指数計算

### 🤖 柔軟なデータ取得
- **API優先**: 内部APIエンドポイント自動検出
- **フォールバック**: Playwright使用の堅牢なスクレイピング
- **レート制限対応**: 適切な間隔でのリクエスト

## 🚀 クイックスタート

### インストール

```bash
# 依存関係のインストール
npm install

# Playwrightブラウザのインストール
npx playwright install
```

### 基本的な使用方法

```bash
# 🚀 一発実行（推奨）- 40デッキ+全相性+完全分析
npm run full-analysis

# 従来の基本収集
npm run collect

# 開発・テスト用
npm run dev
```

**約5-10分で完了** - シェア率40位まで網羅的にデータ収集し、ガイド準拠の完全版分析レポート生成

## 📅 週次自動実行

**毎週金曜日15:00（JST）** にGitHub Actionsで自動実行されます。

### 自動実行内容
- 40デッキの完全データ収集
- 全相性データ収集
- 環境適応型メタ分析実行  
- 週次アーカイブレポート生成
- 結果の自動コミット・プッシュ
- 週次リリース作成

### 手動トリガー
GitHub Actions画面から「workflow_dispatch」で手動実行も可能

## 📋 コマンド一覧

| コマンド | 説明 | 実行時間 | 特徴 |
|----------|------|----------|------|
| `npm run full-analysis` | **【推奨】40デッキ+全相性+完全分析** | 5-10分 | 🚀 最新機能 |
| `npm run weekly-report` | **【自動実行】週次レポート生成** | 5-10分 | 📅 定期自動化 |
| `npm run collect` | 従来の完全収集 | 3-5分 | 基本機能 |
| `npm run collect-decks` | デッキデータのみ高速取得 | 30秒 | 高速 |
| `npm run collect-matchups` | マッチアップデータのみ | 2-5分 | 相性特化 |
| `npm run schedule` | 6時間ごとの定期実行を開始 | - | 自動化 |
| `npm run monitor` | メタ変化の監視と分析 | 1分 | 変化検出 |

## 📊 出力例

### コンソール出力
```
🏆 === 環境分析結果 ===

📊 分析概要:
   • 環境カバー率: 85.3%
   • マッチアップデータ: 12デッキ分
   • 分析対象デッキ数: 45個

📈 期待勝率トップ5:
1. Pikachu ex
   期待勝率: 56.82% 📈 (全体: 54.20%)
   Tier: S (最強候補) | シェア: 15.4%

🎯 推奨トーナメント構成:
メイン: Pikachu ex
   • 期待勝率: 56.82%
   • 信頼度: 90%

🔍 注目の隠れ強デッキ:
• Guzzlord ex Naganadel: 期待勝率+4.8% (シェア1.7%)
```

### 生成されるファイル
- `data/decks_YYYY-MM-DD.json` - 生データ
- `data/report_YYYY-MM-DD.md` - 詳細分析レポート
- `data/decks_YYYY-MM-DD.csv` - CSV形式のデータ
- `data/latest.json` - 最新データへのリンク
- `data/latest_report.md` - 最新レポートへのリンク

## 🏗️ プロジェクト構造

```
limitless-tcg-scraper/
├── src/
│   ├── index.ts           # メインエントリーポイント
│   ├── api/
│   │   ├── client.ts      # APIクライアント
│   │   └── types.ts       # TypeScript型定義
│   ├── scraper/
│   │   ├── browser.ts     # ブラウザ管理
│   │   └── decks.ts       # デッキスクレイパー
│   ├── analyzer/
│   │   ├── optimizer.ts   # 環境適応型分析
│   │   └── advanced.ts    # 高度な分析機能
│   └── storage/
│       └── database.ts    # データ保存管理
├── data/                   # 収集データ保存先
└── README.md
```

## 🔬 技術仕様

### 環境適応型メタスコア算出法

従来の分析手法では見落とされる「現在の環境で実際に勝てるデッキ」を正確に特定するための革新的手法：

#### 核心概念
```typescript
期待勝率 = Σ(対戦相手iとの勝率 × 相手iの環境シェア率)
```

#### Tier判定基準
- **SS (57%+)**: 環境支配レベル
- **S (55-57%)**: 最強候補  
- **A+ (53-55%)**: 実用最強
- **A (51-53%)**: 実用可能
- **B (49-51%)**: 条件付き採用
- **C (49%未満)**: 非推奨

#### 重要な発見例
```
Buzzwole ex Pheromosa
- 全体勝率: 54.65% (高評価に見える)
- 期待勝率: 52.29% (実際は普通)
→ 環境上位デッキへの相性が悪いため

Guzzlord ex Naganadel  
- シェア率: 1.67% (ほぼ無視される)
- 期待勝率: 57.14% (真の環境最強)
→ 従来手法では見落とされていた隠れた王者
```

## 🛠️ カスタマイズ

### 設定の調整

主要な設定は `src/index.ts` で調整可能：

```typescript
// 主要デッキの閾値（相性データ収集対象）
const majorDecks = decks.filter(d => d.share >= 3);

// 定期実行の間隔
setInterval(runCollection, 6 * 60 * 60 * 1000); // 6時間

// メタ変化の検出閾値
if (Math.abs(change) >= 0.5) { // 0.5%以上の変化
```

### API エンドポイントの追加

`src/api/client.ts` でAPIエンドポイントを追加：

```typescript
async getCustomData(): Promise<any> {
  const response = await axios.get(`${this.baseURL}/api/custom/endpoint`, {
    headers: this.headers
  });
  return response.data;
}
```

## 📈 運用のベストプラクティス

### データ収集頻度
- **推奨**: 1日2-3回（朝、昼、夜）
- **ピーク時間を避ける**: サイト負荷軽減のため
- **レート制限対応**: リクエスト間に1秒の間隔

### メンテナンス
```bash
# 古いファイルの自動削除（30日経過）
# storage.cleanOldFiles(30) が自動実行

# 手動でのデータクリーンアップ
rm data/decks_old_*.json
```

## ⚠️ 注意事項

### 利用規約遵守
- サイトの利用規約を必ず確認してください
- 過度なリクエストは控えめに
- 商用利用の場合は事前に許可を取得

### エラー対処
- **API失敗**: 自動的にスクレイピングにフォールバック
- **ネットワークエラー**: 3回までリトライ
- **データ不整合**: ログで詳細情報を確認

### パフォーマンス
- **メモリ使用量**: 大量のデータ処理時は要注意
- **ディスク容量**: データ蓄積により容量増加
- **実行時間**: 初回は10-15分程度

## 🤝 コントリビューション

1. このリポジトリをフォーク
2. 機能ブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m 'Add amazing feature'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

## 📄 ライセンス

MIT License

## 🙋‍♀️ サポート

質問や問題が発生した場合：

1. **ログの確認**: エラーメッセージと状況を記録
2. **Issue作成**: 詳細な情報と再現手順を含めて
3. **環境情報**: OS、Node.jsバージョンなど

---

*このツールは**環境適応型メタスコア算出法**により、従来の分析では見つからない真の強デッキを発見します。継続的な環境変化に対応するため、定期的な更新を推奨します。*
